<?php
if ( isset($this->tour_flg) && $this->tour_flg == true ) {
?>
	<div class="mg-width5 mx-10pt px-10-20pt w-full">
		<div class="tx-size13 whitespace-no-wrap"><strong><?php echo $this->escape($this->list_caption); ?></strong></div>
		<div class="tx-size10 tx-color-gray-dark"></div>
	</div>
<?php
} else {
	// 追加注文モードの時はレジへボタンの送信先を変更
	if ( ! $this->add_item_mode ) {
		$order_edt = 'order_edt.php';
	}else{
		$order_edt = 'add_order_edt.php';
	}
}
?>
<?php $this->render('_parts/modules/campaignItemListBnr.html'); ?>
<?php if (isset($this->item_data)) { ?>
<?php
$p_exec_count = 0;
foreach($this->item_data as $key => $val) { 
?>
		<div class="ml-5 mt-5 mb-1">
			<strong><?php echo $this->category_name[$key]; ?></strong>
		</div>
		<div class="text-size12 ml-5">
	<?php if(isset($val[0]['event_id']) && strlen($val[0]['event_id']) > 0) { ?>
			<a href="<?php echo $this->escape($this->top_page); ?>shop/<?php echo (isset($this->area_shop[0])?$this->escape($this->area_shop[0]['shop_code']):'') ?>/item_lst.php?cmpn=1">全て表示&nbsp;></a>
	<?php } else { ?>
			<a href="<?php echo $this->escape($this->top_page); ?>shop/<?php echo (isset($this->area_shop[0])?$this->escape($this->area_shop[0]['shop_code']):'') ?>/item_lst.php?mgcd=<?php echo $val[0]['g_code'] ?>&cgcd=<?php echo $key ?>">全て表示&nbsp;></a>
	<?php } ?>
		</div>
		<div id="item_list" class="mx-10-15pt m-2 flex overflow-x-scroll overflow-x-hidden whitespace-no-wrap">
	<?php foreach($val as $key_dtl => $val_dtl) {
	$p_exec_count = $this->escape($p_exec_count);

	// お気に入りの商品表示時に取り扱っていない商品の場合はtrue
	$noService = false;
	if (isset($val_dtl['item_exists']) && $val_dtl['item_exists'] == false && $this->disp_mode == 'fvrt') {
		$noService = true;
	}
	// 法人管理者専用商品の場合、対象外会員へ購入不可を表示する
	if (isset($val_dtl['corp_admin_disp_flg']) && $val_dtl['corp_admin_disp_flg'] == 1 && empty($this->corp_admin_flg)) {
		$noService = true;
	}

	// 商品画像があるか。無ければnoimage.jpgを表示
	if (file_exists($this->box_path.$val_dtl['item_code'].'.jpg')
		&& is_readable($this->box_path.$val_dtl['item_code'].'.jpg')
	) {
		clearstatcache();
		$img_url = $this->box_url.$val_dtl['item_code'].'.jpg';
	} else {
		$img_url = $this->box_url.'noimage.jpg';
	}

	// 医薬品フラグ
	if($this->medicine_dealing_flg == 1 && $val_dtl['buy_limit_type'] == 9
		&& isset($val_dtl['medicine_data_exist']) && $val_dtl['medicine_data_exist']
		&& isset($this->side_medicine_Shop_Inquiry_Info) && is_array($this->side_medicine_Shop_Inquiry_Info) && count($this->side_medicine_Shop_Inquiry_Info) > 0){
			$medicine_display_flg = true;
	} else {
		$medicine_display_flg = false;
	}

?>
<?php
	// JSに渡す引数を生成
	$_detail_js_arg  = "'".$this->escape($val_dtl['item_code'])."'";
	if (isset($val_dtl['category_code']) && $val_dtl['category_code'] != '') {
		$_detail_js_arg .= ",'".$this->escape($val_dtl['category_code'])."'";
	} else {
		$_detail_js_arg .= ",''";
	}
?>
			<div class="mr-10">
				<div class="w-120 mb-4">
					<img src="<?php echo $img_url ?>">
					<p class="text-size12 h-40 whitespace-normal webkit-box">
						<?php echo $this->escape($val_dtl['item_area'].$val_dtl['item_name']); ?>
					</p>
					<p class="text-size12">
						<?php echo $this->escape(isset($val_dtl['item_spec']) && strlen($val_dtl['item_spec']) > 0?$val_dtl['item_spec']:' '); ?>
					</p>
					<div class="mt-2 pb-3 relative">
						<b class="tx-color-money">
							<?php if(isset($val_dtl['event_id']) && strlen($val_dtl['event_id']) > 0) {
								echo $this->escape(number_format($val_dtl['event_price']));
							} else {
								echo $this->escape(number_format($val_dtl['sell_price']));
							}?>
							円
						</b>
						<?php $id_val = $val_dtl ?>
						<?php include('okiniiriButton.html'); ?>
					</div>
					<div class="m-auto">
						<?php include('cartButton.html'); ?>
					</div>
				</div>
			</div>
	<?php } ?>
	</div>
	<?php } ?>
<?php } ?>

<div class="bd-b-color-gray-light mt-3"></div>
<?php if (isset($this->mdcn_exists) && $this->mdcn_exists == true): ?>
	<div class="bd-b-color-gray-light">
		<div class="text-right text-size12 tx-color6 m-3"><p><a href="<?php echo $this->escape($this->top_page.'medicine/index.php'); ?>">&raquo;&nbsp;薬店による管理および運営に関する事項を開く</a></p></div>
	</div>
<?php endif; ?>
