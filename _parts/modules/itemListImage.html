<?php if ( isset($this->tour_flg) && $this->tour_flg == true ): ?>
	<div class="mg-width5 mx-10pt px-10-20pt w-full">
		<div class="text-size16 whitespace-no-wrap"><strong><?php echo $this->escape($this->list_caption); ?></strong></div>
	</div>
<?php else: ?>
	<div class="m-2 mb-0 relative inline-block">
		<div class="text-size16 whitespace-no-wrap"><strong><?php echo $this->escape($this->list_caption); ?></strong></div>
	</div>

<?php endif; ?>
<?php $this->render('_parts/modules/campaignItemListBnr.html'); ?>

<?php
echo $this->render('_parts/modules/itemListToolBox.html'); /* ツールボックスHTML */
?>
<?php

$p_exec_count = 0;
foreach ($this->item_data[0] as $id_key => $id_val) {
	$p_exec_count = $this->escape($p_exec_count);

	// お気に入りの商品表示時に取り扱っていない商品の場合はtrue
	$noService = false;
	if (isset($id_val['item_exists']) && $id_val['item_exists'] == false && $this->disp_mode == 'fvrt') {
		$noService = true;
	}
	// 法人管理者専用商品の場合、対象外会員へ購入不可を表示する
	if (isset($id_val['corp_admin_disp_flg']) && $id_val['corp_admin_disp_flg'] == 1 && empty($this->corp_admin_flg)) {
		$noService = true;
	}

	// 商品画像があるか。無ければnoimage.jpgを表示
	if (file_exists($this->box_path.$id_val['item_code'].'.jpg')
		&& is_readable($this->box_path.$id_val['item_code'].'.jpg')
	) {
		clearstatcache();
		$img_url = $this->box_url.$id_val['item_code'].'.jpg';
	} else {
		$img_url = $this->box_url.'noimage.jpg';
	}

	// 医薬品フラグ
	if($this->medicine_dealing_flg == 1 && $id_val['buy_limit_type'] == 9
		&& isset($id_val['medicine_data_exist']) && $id_val['medicine_data_exist']
		&& isset($this->side_medicine_Shop_Inquiry_Info) && is_array($this->side_medicine_Shop_Inquiry_Info) && count($this->side_medicine_Shop_Inquiry_Info) > 0){
			$medicine_display_flg = true;
	} else {
		$medicine_display_flg = false;
	}
?>
	<form name="item_list" action="" method="post" id="itemListForm" class="mb-0">
		<input type="hidden" name="tkn" value="<?php echo $this->escape($this->tkn); ?>" />
		<input type="hidden" name="p_tool_exec" value="" />
		<input type="hidden" name="p_list_file" value="<?php echo $this->escape(basename($this->url)); ?>" />
		<div class="pl-3 pr-3 pt-4 pb-4 w-full bd-b-color-gray-light">

			<div class=" m-1 mt-5 mb-5">
				<div id="d_<?php echo $this->escape($id_val['item_code']); ?>" class="flex flex-no-wrap">
					<input type="hidden" id="p_exec_code_<?php echo $p_exec_count; ?>" name="p_exec_code[]" value="0" />
					<input type="hidden" name="p_item_code[]" value="<?php echo $this->escape($id_val['item_code']); ?>" />
					<input type="hidden" id="item_full_name_<?php echo $this->escape($p_exec_count); ?>" name="item_full_name" value="<?php echo $this->escape($id_val['full_item_name']); ?>" />
<?php
	if (isset($id_val['event_id'])) {
		echo '		<input type="hidden" name="p_event_id[]" value="'.$this->escape($id_val['event_id']).'" />'."\n";
	} else {
		echo '		<input type="hidden" name="p_event_id[]" value="" />'."\n";
	}
	if (isset($id_val['category_code'])) {
		echo '		<input type="hidden" name="p_group_code[]" value="'.$this->escape($id_val['category_code']).'" />'."\n";
	} else {
		echo '		<input type="hidden" name="p_group_code[]" value="" />'."\n";
	}
?>
<?php
	// 詳細画面リンクのJSに渡す引数を生成
	$_detail_js_arg  = "'".$this->escape($id_val['item_code'])."'";
	if (isset($id_val['category_code']) && $id_val['category_code'] != '') {
		$_detail_js_arg .= ",'".$this->escape($id_val['category_code'])."'";
	} else {
		$_detail_js_arg .= ",''";
	}
?>
					<div class="w-100 items-center align-middle mr-5">
<?php
	// 取り扱っているときはリンクを張る
	if (!$noService) {
?>
						<a href="javascript:move_detail(<?php echo $_detail_js_arg; ?>)" class="block">
<?php } ?>
							<img src="<?php echo $this->escape($img_url); ?>" class="inline-block pic-size1" alt="<?php echo $this->escape($id_val['full_item_name']); ?>" />
<?php if (!$noService) { ?>
						</a>
<?php } ?>
					</div>

					<div class="flex-1">
<?php
	// 配列に溜めたアイコンを表示
	if (count($id_val['ary_icon']) == 0) {
	} else {
		foreach ($id_val['ary_icon'] as $val) {
?>
						<div class="mb-2">
							<img src="<?php $val['url'] ?>" alt="<?php $val['alt'] ?>" class="imgItemIcon" />
						</div>
<?php	}
	}
?>
<?php
	if (!$noService) {
		// 残り僅か表示
		if ($id_val['stock_alert'] == true) {
?>
						<div class="mb-2">
							<p class="itemNumAlert">
								<?php echo $this->escape($this->str_stock_alert); ?>
							</p>
						</div>
<?php
		}
	}
?>
						<div class="mb-3">
							<?php echo $this->escape($id_val['item_area']).' '.$this->escape($id_val['item_name']) ?>
						</div>
						<div class="relative mb-3 mt-5">
							<p class="inline-block mr-1 text-size12"><?php echo $this->escape($id_val['item_spec']); ?></p>
							<b class="tx-color-money inline-block text-size16"><?php echo $this->escape(number_format($id_val['base_price'])); ?>円</b>
							<?php include('okiniiriButton.html'); ?>
						</div>
						<div class="w-120 float-right">
							<?php include('cartButton.html'); ?>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
<?php 	$p_exec_count++;
}
?>

<?php //もっと見る ?>
<?php if ($this->exists_next) { ?>
<div id="more_area" class="text-center  tx-button bd-button p-1 w-9/12 m-0 mt-10 m-auto">
	<a href="#" class="more" id="<?php echo $this->escape($this->next_page_no); ?>" url="<?php echo $this->escape($this->url); ?>" loading="<?php echo $this->escape($this->loading_gif); ?>">次の<?php echo $this->escape($this->next_count); ?>件を見る</a>
</div>

<?php //全件数表示 ?>
<div class="text-center tx-base text-size12 m-5">
	<p>全<strong><?php echo $this->escape($this->item_data[1]); ?></strong>件</p>
</div>

<?php } ?>
<?php if (isset($this->mdcn_exists) && $this->mdcn_exists == true): ?>
	<div class="bd-b-color-gray-light">
		<div class="text-right text-size12 tx-color6 m-3"><p><a href="<?php echo $this->escape($this->top_page.'medicine/index.php'); ?>">&raquo;&nbsp;薬店による管理および運営に関する事項を開く</a></p></div>
	</div>
<?php endif; ?>
